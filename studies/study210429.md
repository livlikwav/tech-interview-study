# 210429 목

- 참가자
  - @livlikwav
  - @do168
  - @koreanhole
- 진행 순서
  - 근황 토크
  - 면접 후기 공유
  - 기술 토크
  - 향후 스터디 일정 수립

- 기존 목표 -> 각자 공부해와서 알려주기
  - 운영체제
  - 데이터베이스
  - 자료구조, 네트워크

## 면접 후기 공유

- 회사 1
  - 별도의 문서로 정리
- 회사 2
  - 회사에 지원한 이유
  - React Native Bridge에 대해 설명
  - UI컴포넌트 패키지 만들어 본 적 있나
  - 다른 지원자들에 비해 자신의 강점이 무엇인가
  - 진행했던 프로젝트들에 대해 설명해보라
  - 자신의 장점과 단점에 대해 설명하라
  - React를 사용하면서 어려웠던점이 있었나?
  - 회사에 대한 질문 세가지

## 기술 토크

- [210429 목](#210429-목)
  - [면접 후기 공유](#면접-후기-공유)
  - [기술 토크](#기술-토크)
    - [OAuth은 무엇인가?](#oauth은-무엇인가)
    - [간략한 OAuth 인증과정은 어떻게 되나?](#간략한-oauth-인증과정은-어떻게-되나)
    - [서비스에서 회원 정보를 저장하지 않고, 소셜 로그인 만으로 회원가입-로그인을 제공한다면 어떻게 토큰을 검증하나?](#서비스에서-회원-정보를-저장하지-않고-소셜-로그인-만으로-회원가입-로그인을-제공한다면-어떻게-토큰을-검증하나)
    - [사용자의 토큰이 유효한지 어떻게 확인하는가?](#사용자의-토큰이-유효한지-어떻게-확인하는가)
    - [그렇다면 OAuth를 사용하는 이유는?](#그렇다면-oauth를-사용하는-이유는)
    - [Token 인증 방식을 적용할 때 다들 refresh token을 사용하는가?](#token-인증-방식을-적용할-때-다들-refresh-token을-사용하는가)
    - [사이드 플젝에서는 단순히 단방향 암호화를 적용하여 디비에 저장하곤 하는데, 큰 회사에서는 더 엄격히 적용하기도 하나?](#사이드-플젝에서는-단순히-단방향-암호화를-적용하여-디비에-저장하곤-하는데-큰-회사에서는-더-엄격히-적용하기도-하나)
    - [REST API가 무엇인지, 그 상세 조건을 다 외워야 하나?](#rest-api가-무엇인지-그-상세-조건을-다-외워야-하나)
    - [네트워크 통신에서 keep alive 기능은 무엇인가?](#네트워크-통신에서-keep-alive-기능은-무엇인가)
    - [TFO란?](#tfo란)
    - [소켓 통신할때 소켓도 http나 tcp 같이 프로토콜이야?](#소켓-통신할때-소켓도-http나-tcp-같이-프로토콜이야)
    - [DB Connection Pool이란?](#db-connection-pool이란)
    - [웹 서버가 요청을 어떻게 처리하는 거지? 내부에 큐 같은게 있나?](#웹-서버가-요청을-어떻게-처리하는-거지-내부에-큐-같은게-있나)
    - [아파치 웹 서버에서의 C10K 문제?](#아파치-웹-서버에서의-c10k-문제)
    - [아파치 웹 서버와 Nginx를 비교해서 알아보자](#아파치-웹-서버와-nginx를-비교해서-알아보자)
    - [MQ나 DBCP가 없을 때, 서버 로직 추가만으로 디비 과부하를 방지할 수 있을까?](#mq나-dbcp가-없을-때-서버-로직-추가만으로-디비-과부하를-방지할-수-있을까)
  - [다음 스터디 주제](#다음-스터디-주제)

### OAuth은 무엇인가?

다른 서비스의 API를 이용하기 위해서 사용한다.  
소셜 로그인 기능을 통해서, 회원가입-로그인을 대체하기도 하고,  
토큰을 받아와 서버 내에서 해당 유저 토큰으로 API를 호출하는 등에도 사용한다.  

(복습: JWT, Authentication header에 bearer token 넣던 그 token이다.)

### 간략한 OAuth 인증과정은 어떻게 되나?

예를 들어,  
우리 서비스 웹페이지에서 소셜 로그인을 사용자가 누르면,  
구글이나 카카오 등의 별도의 서비스에 인증 요청을 한다.  
사용자가 access token 발급 받아서 다시 우리 서비스로 전송하고,  
그 token을 통해 해당 사용자를 Authentication하거나,  
그 토큰으로 해당 계정에 대해 카카오 오픈API 등을 사용한다.

### 서비스에서 회원 정보를 저장하지 않고, 소셜 로그인 만으로 회원가입-로그인을 제공한다면 어떻게 토큰을 검증하나?

예를 들어, 카카오 계정으로 회원가입을 한다고 하면,
카카오에서 발급받은 토큰의 body에 있는 identifier값 같은 것으로
서비스 내부에 저장해두고, 로그인할때 해당 값으로 신원을 확인하지 않을까.

### 사용자의 토큰이 유효한지 어떻게 확인하는가?

서버도 똑같이 카카오 API에 토큰이 유효한지 확인하려고 요청을 보낼 것이다.

### 그렇다면 OAuth를 사용하는 이유는?

서비스 회사의 입장:보안 부담을 덜 수 있다.
사용자의 입장: 대기업이 아닌 이상, 비밀번호를 넘겨주기 싫을 것이다. 보안 걱정에.

### Token 인증 방식을 적용할 때 다들 refresh token을 사용하는가?

refresh token이 있어야하냐 없어야하나 이게 회사마다 관점이 다르다.  

반대하는 입장: access token 탈취되면 refresh도 탈취되지 않았겠냐.  
찬성하는 입장: 그래도 있는게 ...

### 사이드 플젝에서는 단순히 단방향 암호화를 적용하여 디비에 저장하곤 하는데, 큰 회사에서는 더 엄격히 적용하기도 하나?

이중 암호화를 하는 경우도 있다고 들었다.

- 클라이언트 자동 로그인의 경우
  
웹은 비밀번호 저장을 하지 않는다. 토큰만 저장한다.  
앱 같은 경우는 비밀번호 저장을 할 수 있긴 한데, 앱도 보통 토큰만 저장한다.  
DB 자체가 털리는 것보단, 통신 상의 위험을 더 걱정하는 편인 것 같다.

### REST API가 무엇인지, 그 상세 조건을 다 외워야 하나?

RESTful  
REpresentational State Transfer  
HTTP API와 구분되는 엄격한 조건이 있다.  
이 조건은 자원과 상태의 표시에 대한 것들이다.

예를 들어,  
자원을 표시하는 것은 URI로 말해주고,  
상태는, GET, POST 등의 HTTP method로 자원을 어떻게 사용하겠다라고 표현하는 식이다.  

### 네트워크 통신에서 keep alive 기능은 무엇인가?

~~work in progress~~

### TFO란?

TCP도 토큰이 있다. 한번 맺고 나면 토큰을 같이 받는다. 맨처음 할때.  
그 다음 요청부터는 TFO로 가능하다.  
~~work in progress~~

### 소켓 통신할때 소켓도 http나 tcp 같이 프로토콜이야?

- 개념을 먼저 정리해보자

HTTP는 L7의 프로토콜. stateless하다. 통신이 가능한지 그 상태를 판단하지 않는다.
보내고 응답을 받지 못했으면 에러를 발생시키는 식이다.

TCP는 L4의 프로토콜. 가상 회선 연결 방식이고, 3-way handshaking을 통해서 통신이 가능한지 확인한다.

Socket은 추상적인 개념의 통신 접속점이다. 서버 소켓이 있고, 클라이언트 소켓이 있는 식이다.  
네트워크 응용 프로그램은 소켓을 통하여 통신망으로 데이터를 송수신 한다.  

응용 프로그램에서 TCP/IP를 이용하는 창구 역할을 하며 (UDP/IP 소켓 프로그래밍도 존재한다.)  
응용 프로그램과 소켓 사이의 인터페이스 역할을 한다.

두 소켓이 연결되면 서로 다른 프로세스끼리 데이터를 전달할 수 있다.

- 질문에 대한 답을 정리해보자

소켓 통신, 소켓 프로그래밍을 말할때 소켓은 프로토콜이 당연히 아니다.  
소켓 통신은 사실 L4 계층의 통신인 것이다.  
예제 Java 코드를 확인하면 이해가 쉽다.

### DB Connection Pool이란?

DB 과부화를 줄여줄 수 있는 방법이다.  

웹 서버가 DB에서 원하는 데이털르 얻어 오기 까지의 과정에서,  
보통 웹 서버에서 물리적으로 DB 서버에 최초로 연결되어 Connection 객체를 생성하는 부분이 비용이 가장 비싸다.
이러한 상황에서 DB Connection 객체를 생성하는 부분에 대한 비용과 대기 시간을 줄이고, 네트워크 연결 부담 줄일 수 있는 방법이 DBCP이다.

Connection Pool을 이용하면 다수의 HTTP 요청에 대한 Thread를 효율적으로 처리할 수 있게 된다.

CP의 구현체의 역할은 이렇다.

1. WAS가 실행되면서 미리 일정량의 DB Connection 객체를 생성하고 Pool이란 공간에 저장해둔다.
2. HTTP 요청에 따라 필요할 때 Pool에서 Connection 객체를 가져다 쓰고 반환한다.
3. 이와 같은 방식으로 HTTP 요청마다 DB Driver를 로드하고 물리적인 연결에 의한 Connection 객체를 생성하는 비용이 줄어들게 된다.

(이 [링크](https://www.holaxprogramming.com/2013/01/10/devops-how-to-manage-dbcp/)를 참고했다. 중요한 내용이 많으니 더 참고하기!)

### 웹 서버가 요청을 어떻게 처리하는 거지? 내부에 큐 같은게 있나?

(검색 결과)  
Nginx 구조를 검색한 것이 도움이 되었다. [참고한 링크](https://velog.io/@wijihoon123/Nginx%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80#:~:text=%EC%9D%84%20%EB%8B%B4%EB%8B%B9%ED%95%A9%EB%8B%88%EB%8B%A4.-,Nginx%EC%9D%98%20%EA%B5%AC%EC%A1%B0,%EB%A1%9C%20%EA%B5%AC%EC%84%B1%EB%90%98%EC%96%B4%20%EC%8B%A4%ED%96%89%EB%90%A9%EB%8B%88%EB%8B%A4.&text=Nginx%EB%8A%94%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EA%B8%B0%EB%B0%98%20%EB%AA%A8%EB%8D%B8,%EC%9D%B8%20%EB%A9%94%EC%BB%A4%EB%8B%88%EC%A6%98%EC%9D%84%20%EC%82%AC%EC%9A%A9%ED%95%A9%EB%8B%88%EB%8B%A4.)

Nginx의 경우에는 어떻게 요청을 처리할까?

![그림](https://media.vlpt.us/images/wijihoon123/post/f7a48e26-ba2f-46eb-a7f6-c0b67e99f03a/nginx.png)

- Nginx는 Event-Driven 구조로 동작한다
  - 한 개 또는 고정된 프로세스만 생성하여 사용하고,
  - 비동기 방식으로 요청들을 Concurrency 하게 처리할 수 있다.
- 새로운 요청이 들어오면
  - 새로운 프로세스와 쓰레드를 생성하지 않는다
    - 따라서 프로세스와 쓰레드 생성 비용이 존재하지 않고,
    - 적은 자원으로도 효율적인 우용이 가능하다.
- 아파치 웹 서버의 C10K 문제점 해결을 목표로 하였다
  - Client 10k(1만) 개를 처리하려면 어떤 방법을 써야하는가
  - 밑에 더 자세히 정리
- 이러한 장점 덕분에 단일 서버에서도 동시에 많은 연결을 처리할 수 있다.

![그림2](https://media.vlpt.us/images/wijihoon123/post/3467a69b-25c0-49e1-ad76-51ee4143c49c/nginx111.png)

- Nginx는 1:N = Master Process:Worker Process로 구성되어 실행된다.
  - Master Process는
    - 설정 파일을 읽고
    - 유효성 검사 및 Worker process를 관리한다.
  - Worker process는
    - 모든 요청을 처리한다.
    - Worker process의 개수는 설정 파일에서 정의되며,
    - 정의된 프로세스 개수와 사용 가능한 CPU 코어 숫자에 맞게 자동으로 조정된다.

### 아파치 웹 서버에서의 C10K 문제?

[참고한 링크](https://heeestorys.tistory.com/513)

- C10K란
  - 하드웨어 성능상 문제가 없어도 클라이언트 수가 많아지면 서버가 고장나는 문제
- 문제 설명
  - 클라이언트 접속마다 프로세스를 생성하면 OS 파일 디스크립터나 프로세스 수가 최대치를 달성할 수 있다.
  - 하나의 프로세스 당 소비 메모리 크기는 작지만 이것이 쌓이는 것도 문제이다.
  - 프로세스 수가 만 단위 이상이 되어 Context Switch 등에 사용되는 CPU 사용률도 문제이다.
  - 프로세스 수가 많으면 프로세스를 관리하는 OS 커널 내의 관리용 데이터 크기도 문제가 된다.
- 이걸 Nginx가 해결한 방법은?
  - Event-Driven 구조 + 1개 또는 고정된 프로세스만 생성해서 사용한다.
    - 요청마다 새로운 프로세스를 생성하지 않는다.

### 아파치 웹 서버와 Nginx를 비교해서 알아보자

[참고한 링크](https://victorydntmd.tistory.com/231)

- Apache 서버는
  - 요청 하나 당 프로세스(또는 쓰레드)가 처리하는 구조이다.
    - 즉 요청이 많을수록 CPU와 메모리 사용이 증가하기 때문에 성능 저하가 있을 수 있다.
  - 또한 프로세스가 blocking되면 요청을 처리하지 못하고, 처리 완료까지 계속 대기하는 일이 발생한다.
  - 이러한 문제들은 Keep Alive를 활성화 함으로써 해결이 가능하지만,
    - Keep Alive 때문에 대량 접속 시 효율이 급격하게 떨어지는 또 다른 문제점이 발생한다.
- Nginx는
  - Event Driven 방식의 웹 서버이다
    - 요청에 대한 각 State를 정의해서, event가 발생할 때마다 event를 처리한다.
  - 그러나 모듈 개발이 어려우며 다양한 모듈이 없다는 것이 단점이다.

~~Apache 서버 보다가 왠걸 Keep Alive에 대해서도 알게 되었다 ㅎㅎ~~

### MQ나 DBCP가 없을 때, 서버 로직 추가만으로 디비 과부하를 방지할 수 있을까? 

@do168님의 질문이었다.
이러한 가정을 제시하셨다.

- Cache miss의 경우에 DB에 요청을 보내게 되는데
- 1번부터 100번의 요청이 거의 동시에 들어오고
- 1번이 DB에서 가져와 Cache에 채우기 전에 99개도 동일하게 DB에 요청을 보낸다면?

이와 같이 디비 과부화를 겪는다면, MQ나 DBCP를 사용하지 않고,  
서버의 책임으로 디비 과부화를 막을 순 없을까?

@do168님이 마저 고민해보고 공유해주시기로 함 ㅎㅎ.

## 다음 스터디 주제

- 오늘의 피드백
  - 이야기가 길어지다보니, 정작 기술면접 스터디는 많이 못함 ㅋㅋ
    - 하지만 다른 기술들에 대해서 깊게 알 수 있었음
  - 그래서 다음에는 여러 주제를 준비해오기보다, 2~3개 주제를 선정 후 같이 깊게 공부해서 대화를 나누자

- 다음 주제
  - TCP
    - TFO, keep alive, 소켓 통신, UDP와의 차이점, HTTP stateless…
  - Process와 Thread
    - OS를 한번 훑었다 싶을 정도로 깊게 ㅎㅎ
  - 트랜잭션
    - 트랜잭션안에 트랜잭션이 있는 서비스
    - 트랜잭션 ACID...

- 남은 이야기
  - database index, B Tree, B+ Tree 등에 대한 @do168님의 강의
